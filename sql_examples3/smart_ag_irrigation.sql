/*
 * Dremio "Messy Data" Challenge: Smart Agriculture Irrigation
 * 
 * Scenario: 
 * IoT soil sensors.
 * 3 Tables: FIELDS (Meta), SENSORS (Device), MOISTURE (Readings).
 * 
 * Objective for AI Agent:
 * 1. Join Tables: MOISTURE -> SENSORS -> FIELDS.
 * 2. Clean Data: Remove reading < 0% or > 100%.
 * 3. Alert: Aggregated Moisture < Threshold.
 */

-------------------------------------------------------------------------------
-- 1. SETUP: Create Raw Folder
-------------------------------------------------------------------------------

CREATE FOLDER IF NOT EXISTS Agri_Tech;
CREATE FOLDER IF NOT EXISTS Agri_Tech.Irrigation;

-------------------------------------------------------------------------------
-- 2. DDL: Create Raw Tables (3 Tables)
-------------------------------------------------------------------------------

CREATE TABLE IF NOT EXISTS Agri_Tech.Irrigation.FIELDS (
    FIELD_ID VARCHAR,
    CROP_TYPE VARCHAR,
    TARGET_MOISTURE INT
);

CREATE TABLE IF NOT EXISTS Agri_Tech.Irrigation.SENSORS (
    SENSOR_ID VARCHAR,
    FIELD_ID VARCHAR,
    INSTALL_DATE DATE,
    STATUS VARCHAR
);

CREATE TABLE IF NOT EXISTS Agri_Tech.Irrigation.EARTH_READINGS (
    READING_ID VARCHAR,
    SENSOR_ID VARCHAR,
    TS TIMESTAMP,
    MOISTURE_PCT DOUBLE
);

-------------------------------------------------------------------------------
-- 3. SEED DATA (50+ Records)
-------------------------------------------------------------------------------

-- FIELDS
INSERT INTO Agri_Tech.Irrigation.FIELDS VALUES
('F-1', 'Corn', 60), ('F-2', 'Wheat', 40), ('F-3', 'Rice', 80);

-- SENSORS
INSERT INTO Agri_Tech.Irrigation.SENSORS VALUES
('S-1', 'F-1', '2023-01-01', 'Active'), ('S-2', 'F-1', '2023-01-01', 'Active'),
('S-3', 'F-2', '2023-01-01', 'Active'), ('S-4', 'F-3', '2023-01-01', 'Active');

-- READINGS (50 Rows)
INSERT INTO Agri_Tech.Irrigation.EARTH_READINGS VALUES
('R-1', 'S-1', '2023-06-01 08:00:00', 55.5), ('R-2', 'S-1', '2023-06-01 09:00:00', 54.0),
('R-3', 'S-1', '2023-06-01 10:00:00', 53.5), ('R-4', 'S-1', '2023-06-01 11:00:00', 52.0),
('R-5', 'S-2', '2023-06-01 08:00:00', 60.0), ('R-6', 'S-2', '2023-06-01 09:00:00', 59.0),
('R-7', 'S-3', '2023-06-01 08:00:00', 40.0), ('R-8', 'S-3', '2023-06-01 09:00:00', 35.0), -- Dry
('R-9', 'S-4', '2023-06-01 08:00:00', 80.0), ('R-10', 'S-4', '2023-06-01 09:00:00', 81.0),
('R-11', 'S-1', '2023-06-02 08:00:00', -10.0), -- Error
('R-12', 'S-1', '2023-06-02 09:00:00', 120.0), -- Error
('R-13', 'S-1', '2023-06-02 10:00:00', NULL),
('R-14', 'S-1', '2023-06-03 08:00:00', 50.0),
('R-15', 'S-1', '2023-06-03 09:00:00', 50.0),
('R-16', 'S-1', '2023-06-03 10:00:00', 50.0),
('R-17', 'S-1', '2023-06-03 11:00:00', 50.0),
('R-18', 'S-1', '2023-06-03 12:00:00', 50.0),
('R-19', 'S-1', '2023-06-03 13:00:00', 50.0),
('R-20', 'S-1', '2023-06-03 14:00:00', 50.0),
('R-21', 'S-1', '2023-06-03 15:00:00', 50.0),
('R-22', 'S-1', '2023-06-03 16:00:00', 50.0),
('R-23', 'S-1', '2023-06-03 17:00:00', 50.0),
('R-24', 'S-2', '2023-06-03 08:00:00', 65.0),
('R-25', 'S-2', '2023-06-03 09:00:00', 65.0),
('R-26', 'S-2', '2023-06-03 10:00:00', 65.0),
('R-27', 'S-2', '2023-06-03 11:00:00', 65.0),
('R-28', 'S-2', '2023-06-03 12:00:00', 65.0),
('R-29', 'S-2', '2023-06-03 13:00:00', 65.0),
('R-30', 'S-2', '2023-06-03 14:00:00', 65.0),
('R-31', 'S-2', '2023-06-03 15:00:00', 65.0),
('R-32', 'S-2', '2023-06-03 16:00:00', 65.0),
('R-33', 'S-2', '2023-06-03 17:00:00', 65.0),
('R-34', 'S-3', '2023-06-03 08:00:00', 30.0), -- Critical
('R-35', 'S-3', '2023-06-03 09:00:00', 29.0),
('R-36', 'S-3', '2023-06-03 10:00:00', 28.0),
('R-37', 'S-3', '2023-06-03 11:00:00', 27.0),
('R-38', 'S-3', '2023-06-03 12:00:00', 26.0),
('R-39', 'S-3', '2023-06-03 13:00:00', 25.0),
('R-40', 'S-3', '2023-06-03 14:00:00', 24.0),
('R-41', 'S-3', '2023-06-03 15:00:00', 23.0),
('R-42', 'S-3', '2023-06-03 16:00:00', 22.0),
('R-43', 'S-3', '2023-06-03 17:00:00', 21.0),
('R-44', 'S-4', '2023-06-03 08:00:00', 79.0),
('R-45', 'S-4', '2023-06-03 09:00:00', 79.0),
('R-46', 'S-4', '2023-06-03 10:00:00', 79.0),
('R-47', 'S-4', '2023-06-03 11:00:00', 79.0),
('R-48', 'S-4', '2023-06-03 12:00:00', 79.0),
('R-49', 'S-4', '2023-06-03 13:00:00', 79.0),
('R-50', 'S-4', '2023-06-03 14:00:00', 79.0);

-------------------------------------------------------------------------------
-- 4. EXAMPLE AI AGENT PROMPT
-------------------------------------------------------------------------------
/*
 * Prompt to Copy/Paste into Dremio AI:
 * "Manage irrigation in Agri_Tech.Irrigation.
 *  
 *  1. Bronze: Raw View of EARTH_READINGS, SENSORS, FIELDS.
 *  2. Silver: 
 *     - Join: EARTH_READINGS -> SENSORS -> FIELDS.
 *     - Clean: Filter Moisture between 0 and 100.
 *  3. Gold: 
 *     - Drought Alert: Fields where Latest Moisture < Target_Moisture - 20.
 *  
 *  Show the SQL."
 */
